---
TITLE: アーキテクチャ
---

## 目次

1. アーキテクチャ構造
2. アーキテクチャの制約
3. 品質特性
4. 設計指針

## 1.アーキテクチャ構造

### 基本的なバッチの構造

|名称|依存|役割|具体例|
|:-:|:-|:-|:-|
|presentation|repositoryとentityに依存する。|アプリの外郭。処理の概要や、アプリに渡される引数を受け取る。|mainメソッド、ログクラス。DB接続クラス。|
|repository|entityに依存する。|アプリに必要な具体的な処理の置き場所。|ファイル、DB、S3などの操作|
|entity|他の階層には依存しない。|アプリに必要な知識|計算式、ドメイン知識、値バリュー|

## 2.アーキテクチャの制約


### クラスの置き場所と使い方

役割が示す通り、クラスの置き場所を階層の役割に合ったところに置くようにします。

依存の方向性が示す通りに使用します。

#### presentation層の場合

具体的な実装は置かないようにします。
repository層とentity層に依存します。

#### repository層の場合

具体的な実装が置かれるようにします。
repository層のクラスはentity層のクラスに依存します。
presentation層のクラスには依存しないようにします。

#### entity層の場合

どの層にも依存しません。
entityに置かれるクラスは他の階層から呼ばれることがあっても、他の階層のクラスを呼ぶことが無いようにします。

## 3.品質特性

バッチアプリケーションが重視するべき品質特性を示す。

1. 可用性 Availability
2. 回復性 Recoverability
3. パフォーマンス Performance
4. セキュリティ Security
5. 変更容易性 Modifiability
6. テスト容易性 Testability

### 可用性

バッチの機能を利用できる時間。その時間内で処理が終わる。
- 何時から何時まで動くか。
- 何時に何が出力されるべきか。

### 回復性

データの不整合、ファイルの破損などを回復する。

### パフォーマンス

想定されるデータ量で時間内に処理が終わる。

### セキュリティ

4C

### 変更容易性

関数からアーキテクチャの構造まで変更を加え易い。

### テスト容易性

テストが実行し易い環境。
テストデータがある。
テストの可視化。
クラス、メソッド、関数の大きさ。

## 4.設計指針

1. Yggdrasill環境のクラウドリソースを使用して可用性、セキュリティ、性能を確保する。
2. 演算されるデータ量、処理の種類、全体のアーキテクチャ、１アプリケーションのアーキテクチャを考慮した技術選択をする。
3. 運用時に問題のあるデータを容易に解くできるようなログ設計を行う。
4. 単体テストがし易いコードを書く。
